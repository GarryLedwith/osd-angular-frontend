<!-- PAGE HEADER SECTION -->
<div class="page-header">
  <div class="header-content">
    <div class="header-title">
      <mat-icon class="header-icon">inventory_2</mat-icon>
      <h1>{{ equipment?.name || 'Equipment Details' }}</h1>
    </div>
    <p class="header-subtitle">
      View equipment information and request bookings
    </p>
  </div>
</div>

<!-- MAIN CONTENT SECTION -->
<div class="content-section">

  <!-- LOADING STATE -->
  @if (loading) {
    <div class="loading-container">
      <mat-icon class="loading-icon">hourglass_empty</mat-icon>
      <p>Loading equipment details...</p>
    </div>
  }

  <!-- EQUIPMENT DETAILS CARD -->
  @if (!loading && equipment) {
    <mat-card class="details-card">
      <mat-card-header>
        <div class="card-header-content">
          <mat-icon class="header-card-icon">info</mat-icon>
          <mat-card-title>Equipment Information</mat-card-title>
        </div>
      </mat-card-header>

      <mat-card-content>
        <!-- Equipment Info Grid -->
        <div class="info-grid">
          <!-- CATEGORY -->
          <div class="info-item">
            <div class="info-label">
              <mat-icon class="info-icon">category</mat-icon>
              Category
            </div>
            <div class="info-value">
              <span class="category-badge">{{ equipment?.category }}</span>
            </div>
          </div>

          <!-- STATUS -->
          <div class="info-item">
            <div class="info-label">
              <mat-icon class="info-icon">info_outline</mat-icon>
              Status
            </div>
            <div class="info-value">
              <span
                class="status-badge"
                [class]="'status-' + equipment?.status">
                {{ equipment?.status }}
              </span>
            </div>
          </div>

          <!-- LOCATION -->
          <div class="info-item">
            <div class="info-label">
              <mat-icon class="info-icon">place</mat-icon>
              Location
            </div>
            <div class="info-value">
              {{ equipment?.location || 'Not specified' }}
            </div>
          </div>

          <!-- MODEL -->
          @if (equipment?.model) {
            <div class="info-item">
              <div class="info-label">
                <mat-icon class="info-icon">devices</mat-icon>
                Model
              </div>
              <div class="info-value">
                {{ equipment?.model }}
              </div>
            </div>
          }
        </div>

        <!-- DESCRIPTION -->
        <div class="description-section">
          <div class="section-title">
            <mat-icon class="section-icon">description</mat-icon>
            <h3>Description</h3>
          </div>
          <p class="description-text">
            {{ equipment?.description || 'No description available.' }}
          </p>
        </div>
      </mat-card-content>
    </mat-card>
  }

  <!-- BOOKING SECTION -->
  <!-- Conditionally displays booking form or unavailable message -->
  @if (!loading && equipment && equipment.status === 'available') {
    <!-- Booking Form Component -->
    <app-equipment-booking-form
      [equipmentId]="equipment?._id || ''"
      [equipmentName]="equipment?.name || ''"
      (createBooking)="onCreateBooking($event)">
    </app-equipment-booking-form>
  } @else {
    <!-- UNAVAILABLE MESSAGE -->
    @if (!loading && equipment) {
      <mat-card class="unavailable-card">
        <mat-card-content>
          <div class="unavailable-message">
            <mat-icon class="unavailable-icon">block</mat-icon>
            <div class="unavailable-text">
              <h3>Not Available for Booking</h3>
              <p>This equipment is currently {{ equipment?.status }} and cannot be booked at this time.</p>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    }
  }

  <!-- STUDENT BOOKINGS CARD -->
  <!-- Displays booking history for this equipment -->
  @if (!loading && equipment) {
    <mat-card class="bookings-card">
      <mat-card-header>
        <div class="card-header-content">
          <mat-icon class="header-card-icon">event_note</mat-icon>
          <mat-card-title>My Booking History</mat-card-title>
        </div>
      </mat-card-header>

      <mat-card-content>
        <!-- Bookings Table -->
        <table
          mat-table
          [dataSource]="bookings"
          class="bookings-table mat-elevation-z1"
        >
          <!-- DATE RANGE Column -->
          <ng-container matColumnDef="dates">
            <th mat-header-cell *matHeaderCellDef>
              <div class="header-cell">
                <mat-icon class="column-icon">date_range</mat-icon>
                Date Range
              </div>
            </th>
            <td mat-cell *matCellDef="let b">
              {{ b.startDate | date: 'shortDate' }} - {{ b.endDate | date: 'shortDate' }}
            </td>
          </ng-container>

          <!-- STATUS Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>
              <div class="header-cell">
                <mat-icon class="column-icon">info</mat-icon>
                Status
              </div>
            </th>
            <td mat-cell *matCellDef="let b">
              <span
                class="booking-status-badge"
                [class]="'booking-status-' + b.status">
                {{ b.status }}
              </span>
            </td>
          </ng-container>

          <!-- CREATED AT Column -->
          <ng-container matColumnDef="createdAt">
            <th mat-header-cell *matHeaderCellDef>
              <div class="header-cell">
                <mat-icon class="column-icon">schedule</mat-icon>
                Requested
              </div>
            </th>
            <td mat-cell *matCellDef="let b">
              {{ b.createdAt | date: 'short' }}
            </td>
          </ng-container>

          <!-- Table Structure -->
          <tr mat-header-row *matHeaderRowDef="displayedBookingColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedBookingColumns;" class="table-row"></tr>

          <!-- EMPTY STATE -->
          @if (!bookingsLoading && bookings.length === 0) {
            <tr class="empty-row">
              <td [attr.colspan]="displayedBookingColumns.length">
                <div class="empty-state">
                  <mat-icon class="empty-icon">event_busy</mat-icon>
                  <p class="empty-message">No bookings yet</p>
                  <p class="empty-hint">You haven't requested any bookings for this equipment</p>
                </div>
              </td>
            </tr>
          }

          <!-- LOADING STATE -->
          @if (bookingsLoading) {
            <tr class="loading-row">
              <td [attr.colspan]="displayedBookingColumns.length">
                <div class="loading-state">
                  <mat-icon class="loading-icon">hourglass_empty</mat-icon>
                  <p class="loading-message">Loading bookings...</p>
                </div>
              </td>
            </tr>
          }
        </table>
      </mat-card-content>
    </mat-card>
  }

</div>
